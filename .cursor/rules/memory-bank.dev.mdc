---
description:
globs:
alwaysApply: true
---
# ğŸ›   Internal Memoryâ€‘Bank Rules (Development)

> **Not shipped** in production builds.
> Loaded only while **developing** the AI Memory Extension.

## Purpose

* Preserve architecture & TODOs across Cursor resets.
* Permit helper MCP tools for research/reasoning.
* Avoid payâ€‘walled services âš ï¸
* If you do research and want to search for anything about a year, use 2025 and NOT 2024
* Use MCP tools where you ever needed - as clear-thoughts for reasoning/thinking/evaluating.
* THE memory-bank/ folder in this project isn't the end-users memory-bank, but yours!

---

## Mustâ€‘Load on Reset

* `core/projectbrief.md` â€“ vision
* `core/activeContext.md` â€“ current focus
* `progress/current.md` â€“ inâ€‘flight tasks

Call **`read-memory-bank-files()`** first thing.

---

## ğŸ›  Research-Validated Helper Tools

### Core Reasoning & Documentation Tools âœ…

| Tool (server) | Status | Strength | GitHub Stars |
| ------------- | ------ | -------- | ------------ |
| **clear-thought** | âœ… Validated | Systematic thinking, planning, hypothesis testing | Multiple implementations |
| **context7** | âœ… Production-ready | Current documentation, API examples (Upstash) | 11.3k stars |
| **codex-keeper** | âœ… Active | Curated best practices, development patterns | 67 stars |
| **docshunter** | ğŸ” Optional | Additional documentation access | Various |
| *any public MIT/Apache server* | ğŸŸ¡ Case-by-case | Evaluate based on utility | No paywall |

### Tool Selection Strategy âœ…
1. **Start Simple**: Use native reasoning for routine tasks
2. **Escalate Strategically**: Use clear-thought for complex planning/validation
3. **Research Current Info**: Use context7 for up-to-date documentation
4. **Validate Practices**: Use codex-keeper for best practices verification
5. **Document Usage**: Log all tool usage in `progress/current.md`

### Usage Rules & Patterns

1. Prefer the *smallest* helpful set for the task at hand
2. Respect each tool's `rateLimit` and API constraints
3. Ask before writing outside `memory-bank/**` folder
4. Log detailed usage to `progress/current.md`:

```markdown
- Used <tool> for <problem> â†’ <outcome>
- Reasoning: <why specific tool was needed>
- Research: <current information discovered>
- Value Added: <insights that wouldn't emerge from native reasoning>
- Validation: <how findings were verified>
```

---

## Development Tool Status

### MCP Memory Bank Tools
| Tool | Dev Status | Production Ready | Notes |
| ---- | ---------- | ---------------- | ----- |
| initialize-memory-bank | âœ… Complete | âœ… Yes | Self-healing initialization |
| read-memory-bank-files | âœ… Complete | âœ… Yes | Tiered loading strategy |
| update-memory-bank-file | âœ… Complete | âœ… Yes | Safe file operations |
| get-memory-bank-metadata | âš ï¸ Implemented | âŒ Testing needed | Mock tests failing |
| append-note | ğŸ§ª Prototype | âŒ Not ready | Needs design review |
| update-current-plan | ğŸ—“ Planned | âŒ Not started | Roadmap item |

### Extension Integration Status
| Component | Status | Notes |
| --------- | ------ | ----- |
| MCP Server Integration | âœ… Production | stdio transport, error boundaries |
| Webview Communication | âœ… Production | postMessage patterns, CSP compliance |
| File Operations | âœ… Production | Path validation, streaming support |
| Error Handling | âœ… Production | AsyncResult patterns, self-healing |
| Testing Framework | âš ï¸ Partial | Needs end-to-end validation |

---

## ğŸ§  Implementation Notes & Best Practices

### Development Practices âœ…
* **Selfâ€‘healing**: Extension autoâ€‘creates missing folders/files on load
* **Shared core logic**: src/core modules feed both MCP server and VSIX extension
* **Architecture**: Organized into app/, core/, cursor/, mcp/, shared/, etc.
* **Path aliases**: Uses @/ and @utils/ for clean imports
* **Cursor config**: Extension updates `.cursor/mcp.json` automatically
* **Code quality**: Check complexity in main source and test code - refactor if high
* **Date accuracy**: ALWAYS run `date` command before updating any dates
* **Cross-reference**: Maintain consistency between rules and memory bank content
* **No auto-update of local memory-bank/**: Changes to rules or service logic (e.g., `@memory-bank-rules.md`, `@memoryBankServiceCore.ts`) must **NOT** trigger automatic updates to the local `memory-bank/` folder. Manual review and explicit action are required to update local memory-bank content after such changes.

### Research & Reasoning Patterns âœ…
* **Enhanced Strategy**: Apply @004-ai-reasoning-strategy.mdc decision matrix
* **Tool Validation**: All referenced MCP tools verified as production-ready
* **Pattern Documentation**: Capture effective tool combinations in systemPatterns/
* **Decision Logging**: Use enhanced logging format for tool usage tracking
* **Memory Integration**: Update memory bank with insights from reasoning sessions

### Testing & Validation âœ…
* **MCP Testing**: Use mcp-testing-kit dummy transport for isolation
* **Extension Testing**: @vscode/test-cli for VS Code API mocking
* **Security Testing**: Validate CSP compliance and input sanitization
* **Performance**: Monitor activation time and memory usage
* **Real-world**: Need more end-to-end production testing

### Security & Safety âœ…
* **Path validation**: Prevent traversal attacks in all file operations
* **Input sanitization**: Zod schemas for all MCP tool parameters
* **CSP enforcement**: Strict Content Security Policy for webview
* **Error boundaries**: Proper error handling throughout the stack
* **Memory limits**: Implement streaming for large files >30KB

## Release Checklist

### Pre-Production Steps
- [ ] Swap to neutral user ruleset (remove development tools)
- [ ] Solve all `// TODO:` markers in codebase
- [ ] Complete metadata system testing and validation
- [ ] Run full end-to-end testing suite
- [ ] Validate VSIX packaging and installation
- [ ] Security audit of webview and MCP integration
- [ ] Performance benchmarking under load
- [ ] Documentation review and accuracy check

### Quality Gates
- [ ] All tests passing (unit, integration, E2E)
- [ ] Code coverage >80% with meaningful tests
- [ ] No security vulnerabilities in dependencies
- [ ] Memory bank rules consistency validated
- [ ] Cross-platform compatibility verified

---

**Integration Status**: Actively validated against production codebase patterns
**Last Updated**: 2025-06-07 (enhanced with research findings and practical patterns)
