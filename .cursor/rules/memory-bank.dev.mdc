---
description:
globs:
alwaysApply: true
---
# 🛠  Internal Memory‑Bank Rules (Development)

> **Not shipped** in production builds.
> Loaded only while **developing** the AI Memory Extension.

## Purpose

* Preserve architecture & TODOs across Cursor resets.
* Permit helper MCP tools for research/reasoning.
* Avoid pay‑walled services ⚠️
* If you do research and want to search for anything about a year, use 2025 and NOT 2024
* Use MCP tools where you ever needed - as clear-thoughts for reasoning/thinking/evaluating.
* THE memory-bank/ folder in this project isn't the end-users memory-bank, but yours!

---

## Must‑Load on Reset

* `core/projectbrief.md` – vision
* `core/activeContext.md` – current focus
* `progress/current.md` – in‑flight tasks

Call **`read-memory-bank-files()`** first thing.

---

## 🛠 Research-Validated Helper Tools

> For reasoning tools, selection strategy, and detailed usage patterns see **@004-ai-reasoning-strategy.mdc**. The sections below keep only development-specific notes not covered elsewhere.

### Core Reasoning & Documentation Tools ✅

*(See @004-ai-reasoning-strategy.mdc for full list of validated MCP servers, tool selection criteria, and usage patterns.)*

---

## Development Tool Status

### MCP Memory Bank Tools
| Tool | Dev Status | Production Ready | Notes |
| ---- | ---------- | ---------------- | ----- |
| initialize-memory-bank | ✅ Complete | ✅ Yes | Self-healing initialization |
| read-memory-bank-files | ✅ Complete | ✅ Yes | Tiered loading strategy |
| update-memory-bank-file | ✅ Complete | ✅ Yes | Safe file operations |
| get-memory-bank-metadata | ⚠️ Implemented | ❌ Testing needed | Mock tests failing |
| append-note | 🧪 Prototype | ❌ Not ready | Needs design review |
| update-current-plan | 🗓 Planned | ❌ Not started | Roadmap item |

### Extension Integration Status
| Component | Status | Notes |
| --------- | ------ | ----- |
| MCP Server Integration | ✅ Production | stdio transport, error boundaries |
| Webview Communication | ✅ Production | postMessage patterns, CSP compliance |
| File Operations | ✅ Production | Path validation (streaming disabled) |
| Error Handling | ✅ Production | AsyncResult patterns, self-healing |
| Testing Framework | ⚠️ Partial | Needs end-to-end validation |

---

## 🧠 Implementation Notes & Best Practices

### Development Practices ✅
* **Self‑healing**: Extension auto‑creates missing folders/files on load
* **Shared core logic**: src/core modules feed both MCP server and VSIX extension
* **Architecture**: Organized into app/, core/, cursor/, mcp/, shared/, etc.
* **Path aliases**: Uses @/ and @utils/ for clean imports
* **Cursor config**: Extension updates `.cursor/mcp.json` automatically
* **Code quality**: Check complexity in main source and test code - refactor if high
* **Date accuracy**: ALWAYS run `date` command before updating any dates
* **Cross-reference**: Maintain consistency between rules and memory bank content
* **No auto-update of local memory-bank/**: Changes to rules or service logic (e.g., `@memory-bank-rules.md`, `@memoryBankServiceCore.ts`) must **NOT** trigger automatic updates to the local `memory-bank/` folder. Manual review and explicit action are required to update local memory-bank content after such changes.

### Research & Reasoning Patterns ✅
* **Enhanced Strategy**: Apply @004-ai-reasoning-strategy.mdc decision matrix
* **Tool Validation**: All referenced MCP tools verified as production-ready
* **Pattern Documentation**: Capture effective tool combinations in systemPatterns/
* **Decision Logging**: Use enhanced logging format for tool usage tracking
* **Memory Integration**: Update memory bank with insights from reasoning sessions

### Testing & Validation ✅
* **MCP Testing**: Use mcp-testing-kit dummy transport for isolation
* **Extension Testing**: @vscode/test-cli for VS Code API mocking
* **Security Testing**: Validate CSP compliance and input sanitization
* **Performance**: Monitor activation time and memory usage
* **Real-world**: Need more end-to-end production testing

### Security & Safety ✅
* **Path validation**: Prevent traversal attacks in all file operations
* **Input sanitization**: Zod schemas for all MCP tool parameters
* **CSP enforcement**: Strict Content Security Policy for webview
* **Error boundaries**: Proper error handling throughout the stack

*Streaming and heavy caching layers have been **disabled** for this project; typical docs are small, so standard file IO suffices.*

## Release Checklist

### Pre-Production Steps
- [ ] Swap to neutral user ruleset (remove development tools)
- [ ] Solve all `// TODO:` markers in codebase
- [ ] Complete metadata system testing and validation
- [ ] Run full end-to-end testing suite
- [ ] Validate VSIX packaging and installation
- [ ] Security audit of webview and MCP integration
- [ ] Performance benchmarking under load
- [ ] Documentation review and accuracy check

### Quality Gates
- [ ] All tests passing (unit, integration, E2E)
- [ ] Code coverage >80% with meaningful tests
- [ ] No security vulnerabilities in dependencies
- [ ] Memory bank rules consistency validated
- [ ] Cross-platform compatibility verified

---

**Integration Status**: Actively validated against production codebase patterns
**Last Updated**: 2025-06-07 (enhanced with research findings and practical patterns)
